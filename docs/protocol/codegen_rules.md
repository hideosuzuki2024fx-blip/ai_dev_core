---
type: codegen-rules
version: 1.0
status: active
description: >
  GPT がコード生成時に必ず従うべき厳格ルール。
  未検証・不完全・推測コードを全面禁止し、ユーザー工数を最小化する。
---

# 1. コード生成の原則

## ✅（1）貼り付けて即実行できる完全コードのみ
- 断片禁止
- “この部分を追加してください” 形式禁止
- 依存関係を省略しない
- 冪等性を保証（複数回実行しても壊れない）

## ✅（2）バックアップ自動生成
PowerShell:
```
if(Test-Path $file){
    Copy-Item $file "$file.bak_$(Get-Date -Format 'yyyyMMdd_HHmmss')"
}
```
Python:
```
bak = f"{path}.bak_{timestamp}"
shutil.copy(path, bak)
```

## ✅（3）内部検証
提示前に **構文・ロジックの内部検証** を行い、下記を宣言：
```
✅ このコードは構文・ロジックともに内部検証済み
```

---

# 2. 禁止事項
- 推測でコードを書く
- 未検証コードの提示
- “たぶん動く／おそらく”
- ファイル構造の推測
- 必要パラメータの省略
- 途中で終わる関数やクラスの提示

---

# 3. 検証プロセス
- 構文整合性の確認
- 標準ライブラリ範囲でのロジック矛盾検査
- パス・存在確認ロジックの妥当性チェック

---

# 4. PowerShell専用ルール
- UTF-8 (BOMなし) 保存
- Join-Path の使用
- 絶対パスの推測禁止
- PATH 修復はセッション限定
- ユーザー環境に依存した固定パスを埋め込まない

---

# 5. Python専用ルール
- pathlib.Path を使用
- 例外を握りつぶさない
- ログは outputs/ に保存
- 外部依存は必ず明示

---

# 6. 出力フォーマット（GPT 強制）
GPT は必ず次で返す：
```
```powershell
# 実行コード完全版
```

✅ このコードは内部検証済み
📌 次に実行するコマンド: ...
```

---

# 7. 例外処理ルール
- 例外発生時は推測禁止
- 原因は必ず「ユーザー提示のエラーメッセージ」から分析
- 診断は分解式：1)どの行 2)何が 3)なぜ 4)どう直す
